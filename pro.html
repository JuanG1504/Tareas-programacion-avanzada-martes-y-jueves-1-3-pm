<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sistema de inscripción de cursos</title>
  <script src="tau-prolog.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-4xl">
    <h1 class="text-2xl font-bold text-center text-indigo-700 mb-6"> Sistema de Inscripción de Cursos</h1>
    
    <!-- Selector alumno -->
    <div class="mb-6">
      <label for="alumno" class="block text-lg font-medium text-gray-700 mb-2">Seleccione un alumno:</label>
      <select id="alumno" class="w-full border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 p-2">
        <option value="jon">Jon</option>
        <option value="maria">María</option>
        <option value="pedro">Pedro</option>
        <option value="laura">Laura</option>
        <option value="henry">Henry</option>
      </select>
    </div>

   

   
    <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 shadow">
      <h2 class="text-xl font-semibold text-yellow-700 mb-4">Verificar inscripción</h2>
      
      <div class="grid md:grid-cols-2 gap-4 mb-4">
        <div>
          <label for="curso" class="block text-gray-700 font-medium mb-2">Seleccione un curso:</label>
          <select id="curso" class="w-full border-gray-300 rounded-xl shadow-sm focus:ring-yellow-500 focus:border-yellow-500 p-2">
            <option value="matematicas">Matemáticas</option>
            <option value="calculo">Cálculo</option>
            <option value="programacion">Programación</option>
            <option value="programacion2">Programación II</option>
            <option value="bases_datos">Bases de Datos</option>
            <option value="ia">Inteligencia Artificial</option>
          </select>
        </div>
      </div>

      

      <div class="flex justify-center">
        <button onclick="verificarInscripcion()" 
                class="bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition">
          Verificar inscripción
        </button>
      </div>

      <p id="resultado" class="mt-4 text-lg font-medium text-center"></p>
    </div>
    
   <br>
    <div class="flex justify-center mb-6">
      <button onclick="consultaCursos()" 
              class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition">
        Consultar estado académico
      </button>
    </div>
    <div class="grid md:grid-cols-3 gap-6 mb-8">
 
      <div class="bg-green-50 border border-green-200 rounded-xl p-4 shadow">
        <h2 class="text-lg font-semibold text-green-700 mb-3">Cursos Aprobados</h2>
        <ul id="aprobados" class="list-disc list-inside text-gray-700"></ul>
      </div>


      <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 shadow">
        <h2 class="text-lg font-semibold text-blue-700 mb-3">Puede Inscribir</h2>
        <ul id="respuesta" class="list-disc list-inside text-gray-700"></ul>
      </div>

      
      <div class="bg-red-50 border border-red-200 rounded-xl p-4 shadow">
        <h2 class="text-lg font-semibold text-red-700 mb-3"> Cursos Bloqueados</h2>
        <ul id="bloqueados" class="list-disc list-inside text-gray-700"></ul>
      </div>
    </div>
  </div>

  
  
  <script id="cursos.pl" type="text/prolog">
    % Cursos
    curso(matematicas).
    curso(calculo).
    curso(programacion).
    curso(programacion2).
    curso(bases_datos).
    curso(ia).

    % Prerequisitos
    prerequisito(calculo, matematicas).
    prerequisito(programacion2, programacion).
    prerequisito(bases_datos, programacion).
    prerequisito(ia, bases_datos).
    prerequisito(ia, programacion2).

    % Alumnos y cursos aprobados
    aprobado(jon, matematicas).
    aprobado(jon, programacion).

    aprobado(maria, matematicas).
    aprobado(maria, calculo).

    aprobado(pedro, matematicas).
    aprobado(pedro, calculo).
    aprobado(pedro, programacion).
    aprobado(pedro, programacion2).

    aprobado(laura, matematicas).

    aprobado(henry, matematicas).
    aprobado(henry, programacion).
    aprobado(henry, programacion2).
    aprobado(henry, bases_datos).

    % Reglas
    puede_inscribir(Alumno, Curso) :-
      curso(Curso),
      \+ aprobado(Alumno, Curso),
      forall(prerequisito(Curso, Req), aprobado(Alumno, Req)).

    faltan(Alumno, Curso, Req) :-
      curso(Curso),
      \+ aprobado(Alumno, Curso),
      prerequisito(Curso, Req),
      \+ aprobado(Alumno, Req).
  </script>

 
  <script>
  
    async function consultaCursos(){
      const alumno = document.getElementById("alumno").value;
      const script = document.getElementById("cursos.pl").textContent;

     
      document.getElementById("aprobados").innerHTML = "";
      document.getElementById("respuesta").innerHTML = "";
      document.getElementById("bloqueados").innerHTML = "";

     
      const sessionA = pl.create();
      sessionA.consult(script);
      sessionA.query(`aprobado(${alumno},Curso).`);
      function mostrarAprobados(){
        sessionA.answer(x=>{
          if(x !== false){
            let curso = x.lookup("Curso").id;
            let li = document.createElement("li");
            li.textContent = curso;
            document.getElementById("aprobados").appendChild(li);
            mostrarAprobados();
          }
        });
      }
      mostrarAprobados();

  
      const sessionB = pl.create();
      sessionB.consult(script);
      sessionB.query(`puede_inscribir(${alumno},Curso).`);
      function mostrarDisponibles(){
        sessionB.answer(x=>{
          if(x !== false){
            let curso = x.lookup("Curso").id;
            let li = document.createElement("li");
            li.textContent = curso;
            document.getElementById("respuesta").appendChild(li);
            mostrarDisponibles();
          }
        });
      }
      mostrarDisponibles();

    
      const sessionC = pl.create();
      sessionC.consult(script);
      sessionC.query(`faltan(${alumno},Curso,Req).`);
      let cursosBloqueados = {};
      function mostrarBloqueados(){
        sessionC.answer(x=>{
          if(x !== false){
            let curso = x.lookup("Curso").id;
            let req = x.lookup("Req").id;
            if(!cursosBloqueados[curso]){
              cursosBloqueados[curso] = [];
            }
            cursosBloqueados[curso].push(req);
            mostrarBloqueados();
          }else{
            for(let c in cursosBloqueados){
              let li = document.createElement("li");
              li.textContent = `${c} (faltan: ${cursosBloqueados[c].join(", ")})`;
              document.getElementById("bloqueados").appendChild(li);
            }
          }
        });
      }
      mostrarBloqueados();
    }

  
    async function verificarInscripcion(){
      const alumno = document.getElementById("alumno").value;
      const curso = document.getElementById("curso").value;
      const script = document.getElementById("cursos.pl").textContent;
      const resultado = document.getElementById("resultado");

   
      const session1 = pl.create();
      session1.consult(script);
      session1.query(`aprobado(${alumno},${curso}).`);
      session1.answer(x=>{
        if(x !== false){
          resultado.textContent = ` ${alumno} ya completó el curso de ${curso}.`;
          resultado.className = "mt-4 text-green-700 font-semibold text-center";
        }else{
          
          const session2 = pl.create();
          session2.consult(script);
          session2.query(`puede_inscribir(${alumno},${curso}).`);
          session2.answer(y=>{
            if(y !== false){
              resultado.textContent = ` ${alumno} cumple los requisitos y puede inscribir ${curso}.`;
              resultado.className = "mt-4 text-blue-700 font-semibold text-center";
            }else{
            
              const session3 = pl.create();
              session3.consult(script);
              session3.query(`faltan(${alumno},${curso},Req).`);
              let faltantes = [];
              function buscarFaltantes(){
                session3.answer(z=>{
                  if(z !== false){
                    faltantes.push(z.lookup("Req").id);
                    buscarFaltantes();
                  }else{
                    resultado.textContent = ` ${alumno} no cumple los requisitos para ${curso}. (Faltan: ${faltantes.join(", ")})`;
                    resultado.className = "mt-4 text-red-700 font-semibold text-center";
                  }
                });
              }
              buscarFaltantes();
            }
          });
        }
      });
    }
  </script>
</body>
</html>
